{"version":3,"sources":["chatbot.js","conversation.js"],"names":["Chat","elem","conversation","this","canvas","chat","document","createElement","answers","className","appendChild","say","prototype","createBubble","text","response","bubble","innerHTML","addBubble","options","Object","assign","end","animate","item","content","style","transform","opacity","setTimeout","call","bind","addAnswer","delay","addEventListener","animateAnswer","answer","slice","parentNode","children","forEach","child","cloneNode","visibility","bubbleR","getBoundingClientRect","display","answerR","left","top","chooseAnswer","Array","index","path","callback","writeAnswer","sendMessage","innerText","contentEditable","message","_this","classList","add","event","requestAnimationFrame","keyCode","preventDefault","removeEventListener","focus","i","length","_typeof","type","getElementById","start","whats-up","contact","console","log","contact-thanks","email","test","contact-wrong-email","contact-email-again","contact-no-email","contact-success"],"mappings":"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","file":"chat.min.js","sourcesContent":["function Chat( elem, conversation ){\n    if( !elem ) return;\n    // Target Element\n    this.canvas = elem;\n    this.conversation = conversation;\n\n    // Create the nessesary children\n    this.chat = document.createElement('ul');\n    this.answers = document.createElement('div');\n\n    // Assign the Classes to the Elements\n    this.chat.className = 'chat__list';\n    this.answers.className = 'chat__answers';\n\n    // Append the Elements to the Canvas\n    this.canvas.appendChild( this.chat );\n    this.canvas.appendChild( this.answers );\n\n    // Kick the Conversation off!\n    this.say(\"start\");\n}\n\nChat.prototype.createBubble = function( text, response ){\n    var bubble = document.createElement('div');\n\n    bubble.className = ( response == true ) ? 'chat__bubble chat__bubble--response' : 'chat__bubble';\n    bubble.innerHTML = text;\n\n    return bubble;\n}\n\nChat.prototype.addBubble = function( bubble, options ){\n\n    var options = Object.assign({}, {\n        end: function(){},\n        animate: true,\n    }, options);\n\n    var item = document.createElement('li');\n    item.className = 'chat__item';\n    item.appendChild( bubble );\n\n    if( options.animate == true ){\n        var content = bubble.innerHTML;\n        bubble.innerHTML = \"…\";\n        bubble.style.transform = \"translate( -4em, 0 )\";\n        bubble.style.opacity = \"0\";\n\n        setTimeout(function(){\n            bubble.style.transform = \"translate( 0, 0 )\";\n            bubble.style.opacity = \"1\";\n        }, 30);\n\n        setTimeout(function(){\n            bubble.innerHTML = content;\n            options.end.call( this, item );\n        }.bind(this), 800);\n    }\n\n    this.chat.appendChild( item );\n}\n\nChat.prototype.addAnswer = function( bubble, options ){\n\n    var options = Object.assign({}, {\n        delay: 0,\n        end: function(){}\n    }, options);\n\n    bubble.style.transform = \"translate( 0, 3em )\";\n    bubble.style.opacity = \"0\";\n\n    setTimeout( function(){\n        bubble.style.transform = \"translate( 0, 0 )\";\n        bubble.style.opacity = \"1\";\n    }, options.delay );\n\n    bubble.addEventListener( 'transitionend', options.end.bind( this, bubble ), false );\n\n    this.answers.appendChild( bubble );\n}\n\nChat.prototype.animateAnswer = function( answer, options ){\n\n    var options = Object.assign({}, {\n        end: function(){}\n    }, options);\n\n    var children = [].slice.call( answer.parentNode.children );\n    children.forEach(function( child ){\n        if( child == answer ) return;\n\n        child.style.transform = \"translate( 0, 3em )\";\n        child.style.opacity = \"0\";\n    });\n\n\n    var bubble = answer.cloneNode(true);\n    bubble.style.visibility = \"hidden\";\n    this.addBubble(bubble, { animate: false });\n\n    var bubbleR = bubble.getBoundingClientRect();\n\n    bubble.style.display = \"none\";\n\n    var answerR = answer.getBoundingClientRect();\n\n    answer.addEventListener('transitionend', function(){\n        this.answers.innerHTML = \"\";\n        bubble.style.visibility = \"\";\n        bubble.style.display = \"\";\n        options.end.call(this);\n    }.bind(this));\n\n    answer.style.transform = \"translate(\"+( bubbleR.left-answerR.left )+\"px,\"+( bubbleR.top-answerR.top )+\"px)\";\n}\n\nChat.prototype.chooseAnswer = function( answers ){\n    var answers = answers instanceof Array ? answers : [answers];\n\n    answers.forEach(function(answer, index){\n        var bubble = this.createBubble( answer.text, true );\n        bubble.addEventListener('click', function(){\n\n            this.animateAnswer(bubble, {\n                end: function(){\n                    if( \"path\" in answer ){\n                        this.say( answer.path );\n                    }\n                    if( \"callback\" in answer ){\n                        answer.callback.call( this );\n                    }\n                }\n            });\n\n\n        }.bind(this));\n        this.addAnswer(bubble, {\n            delay: index * 50\n        });\n    }.bind(this));\n}\n\nChat.prototype.writeAnswer = function( answer ){\n    var _this = this;\n    var bubble = this.createBubble('', true);\n    bubble.classList.add('chat__bubble--input');\n    bubble.contentEditable = true;\n\n    function sendMessage(){\n        if( !bubble.innerText ) return;\n\n        bubble.contentEditable = false;\n        var message = bubble.innerText;\n\n        _this.animateAnswer(bubble, {\n            end: function(){\n                if( \"path\" in answer ){\n                    _this.say( answer.path );\n                }\n                if( \"callback\" in answer ){\n                    answer.callback.call( _this, message );\n                }\n            }\n        })\n\n    }\n\n    bubble.addEventListener('paste', function(event){\n        requestAnimationFrame(function() {\n            bubble.innerHTML = bubble.innerText;\n        });\n    });\n\n    bubble.addEventListener( 'blur', sendMessage );\n\n    bubble.addEventListener('keydown', function(event){\n        if( event.keyCode == 13 ){\n            event.preventDefault();\n            bubble.removeEventListener( 'blur', sendMessage );\n            sendMessage();\n        }\n    });\n\n    this.addAnswer(bubble, {\n        end: function(){\n            bubble.focus();\n        }\n    });\n}\n\nChat.prototype.say = function( path ){\n    var message = this.conversation[ path ];\n    var message = message instanceof Array ? message : [message];\n\n    for( var i = 0; i < message.length; i++ ){\n        setTimeout( function( item ){\n            if( typeof item == 'object' ){\n                if( item.type == 'choose' ){\n                    this.chooseAnswer( item.answers );\n                }else if( item.type == 'text' ){\n                    this.writeAnswer( item );\n                }\n            }else{\n                var bubble = this.createBubble( item );\n                this.addBubble( bubble );\n            }\n        }.bind( this, message[i] ), 1200 * i + 350 );\n    }\n\n}\n","new Chat(document.getElementById('chat'), {\n    start: [ 'Moin!', 'Möchten Sie reden oder mir eine Nachricht senden?', {\n        type: 'choose',\n        answers: [{\n            text: 'Was gibt\\'s neues?',\n            path: 'whats-up'\n        }, {\n            text: 'Etwas schreiben!',\n            path: 'contact'\n        }]\n    }],\n    \"whats-up\": 'Also zu Zeit...',\n    \"contact\": ['Dann erzähl mal!', {\n        type: 'text',\n        path: 'contact-thanks',\n        callback: function(message){\n            console.log( message );\n        }\n    }],\n    \"contact-thanks\": ['Vielen Dank für die Nachricht!', 'Ich brauche noch Ihre E-Mail Adresse, damit ich auf Sie zurückkommen kann.', {\n        type: 'text',\n        callback: function( email ){\n            if( /[^@\\s]+@[^@\\s]+\\.[^@\\s]+/.test(email) ){\n                this.say('contact-success')\n            }else{\n                this.say('contact-wrong-email');\n            }\n        }\n    }],\n    \"contact-wrong-email\": [\"Hmm\", \"An der E-Mail Adresse kann etwas nicht stimmen\", \"Möchten Sie Sie erneut schreiben?\", {\n        type: 'choose',\n        answers: [{\n            text: 'Ja',\n            path: 'contact-email-again'\n        }, {\n            text: 'Nein',\n            path: 'contact-no-email'\n        }]\n    }],\n    \"contact-email-again\": {\n        type: 'text',\n        callback: function( email ){\n            if( /[^@\\s]+@[^@\\s]+\\.[^@\\s]+/.test(email) ){\n                this.say('contact-success')\n            }else{\n                this.say('contact-wrong-email');\n            }\n        }\n    },\n    \"contact-no-email\": [\"Kein Problem\", \"Ich notiere mir die Nachricht trotzdem :-)\"],\n    \"contact-success\": [\"Vielen Dank!\", \"Ich habe mir die Nachricht und Ihre E-Mail notiert :-)\"]\n});\n"]}