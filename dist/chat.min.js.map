{"version":3,"sources":["chatbot.js"],"names":["Chat","elem","conversation","this","canvas","chat","document","createElement","answers","className","appendChild","say","prototype","createBubble","text","response","bubble","innerHTML","addBubble","options","Object","assign","end","animate","item","content","style","transform","opacity","setTimeout","call","bind","addAnswer","delay","addEventListener","animateAnswer","answer","slice","parentNode","children","forEach","child","cloneNode","visibility","bubbleR","getBoundingClientRect","display","answerR","left","top","chooseAnswer","Array","index","path","callback","writeAnswer","_this","sendMessage","innerText","contentEditable","message","classList","add","event","requestAnimationFrame","keyCode","preventDefault","removeEventListener","focus","i","length","_typeof","type"],"mappings":"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","file":"chat.min.js","sourcesContent":["function Chat( elem, conversation ){\n    if( !elem ) return;\n    // Target Element\n    this.canvas = elem;\n    this.conversation = conversation;\n\n    // Create the nessesary children\n    this.chat = document.createElement('ul');\n    this.answers = document.createElement('div');\n\n    // Assign the Classes to the Elements\n    this.chat.className = 'chat__list';\n    this.answers.className = 'chat__answers';\n\n    // Append the Elements to the Canvas\n    this.canvas.appendChild( this.chat );\n    this.canvas.appendChild( this.answers );\n\n    // Kick the Conversation off!\n    this.say(\"start\");\n}\n\nChat.prototype.createBubble = function( text, response ){\n    var bubble = document.createElement('div');\n\n    bubble.className = ( response == true ) ? 'chat__bubble chat__bubble--response' : 'chat__bubble';\n    bubble.innerHTML = text;\n\n    return bubble;\n}\n\nChat.prototype.addBubble = function( bubble, options ){\n\n    var options = Object.assign({}, {\n        end: function(){},\n        animate: true,\n    }, options);\n\n    var item = document.createElement('li');\n    item.className = 'chat__item';\n    item.appendChild( bubble );\n\n    if( options.animate == true ){\n        var content = bubble.innerHTML;\n        bubble.innerHTML = \"â€¦\";\n        bubble.style.transform = \"translate( -4em, 0 )\";\n        bubble.style.opacity = \"0\";\n\n        setTimeout(function(){\n            bubble.style.transform = \"translate( 0, 0 )\";\n            bubble.style.opacity = \"1\";\n        }, 30);\n\n        setTimeout(function(){\n            bubble.innerHTML = content;\n            options.end.call( this, item );\n        }.bind(this), 800);\n    }\n\n    this.chat.appendChild( item );\n}\n\nChat.prototype.addAnswer = function( bubble, options ){\n\n    var options = Object.assign({}, {\n        delay: 0,\n        end: function(){}\n    }, options);\n\n    bubble.style.transform = \"translate( 0, 3em )\";\n    bubble.style.opacity = \"0\";\n\n    setTimeout( function(){\n        bubble.style.transform = \"translate( 0, 0 )\";\n        bubble.style.opacity = \"1\";\n    }, options.delay );\n\n    bubble.addEventListener( 'transitionend', options.end.bind( this, bubble ), false );\n\n    this.answers.appendChild( bubble );\n}\n\nChat.prototype.animateAnswer = function( answer, options ){\n\n    var options = Object.assign({}, {\n        end: function(){}\n    }, options);\n\n    var children = [].slice.call( answer.parentNode.children );\n    children.forEach(function( child ){\n        if( child == answer ) return;\n\n        child.style.transform = \"translate( 0, 3em )\";\n        child.style.opacity = \"0\";\n    });\n\n\n    var bubble = answer.cloneNode(true);\n    bubble.style.visibility = \"hidden\";\n    this.addBubble(bubble, { animate: false });\n\n    var bubbleR = bubble.getBoundingClientRect();\n\n    bubble.style.display = \"none\";\n\n    var answerR = answer.getBoundingClientRect();\n\n    answer.addEventListener('transitionend', function(){\n        this.answers.innerHTML = \"\";\n        bubble.style.visibility = \"\";\n        bubble.style.display = \"\";\n        options.end.call(this);\n    }.bind(this));\n\n    answer.style.transform = \"translate(\"+( bubbleR.left-answerR.left )+\"px,\"+( bubbleR.top-answerR.top )+\"px)\";\n}\n\nChat.prototype.chooseAnswer = function( answers ){\n    var answers = answers instanceof Array ? answers : [answers];\n\n    answers.forEach(function(answer, index){\n        var bubble = this.createBubble( answer.text, true );\n        bubble.addEventListener('click', function(){\n\n            this.animateAnswer(bubble, {\n                end: function(){\n                    if( \"path\" in answer ){\n                        this.say( answer.path );\n                    }\n                    if( \"callback\" in answer ){\n                        answer.callback.call( this );\n                    }\n                }\n            });\n\n\n        }.bind(this));\n        this.addAnswer(bubble, {\n            delay: index * 50\n        });\n    }.bind(this));\n}\n\nChat.prototype.writeAnswer = function( answer ){\n    var _this = this;\n    var bubble = this.createBubble('', true);\n    bubble.classList.add('chat__bubble--input');\n    bubble.contentEditable = true;\n\n    function sendMessage(){\n        if( !bubble.innerText ) return;\n\n        bubble.contentEditable = false;\n        var message = bubble.innerText;\n\n        _this.animateAnswer(bubble, {\n            end: function(){\n                if( \"path\" in answer ){\n                    _this.say( answer.path );\n                }\n                if( \"callback\" in answer ){\n                    answer.callback.call( _this, message );\n                }\n            }\n        })\n\n    }\n\n    bubble.addEventListener('paste', function(event){\n        requestAnimationFrame(function() {\n            bubble.innerHTML = bubble.innerText;\n        });\n    });\n\n    bubble.addEventListener( 'blur', sendMessage );\n\n    bubble.addEventListener('keydown', function(event){\n        if( event.keyCode == 13 ){\n            event.preventDefault();\n            bubble.removeEventListener( 'blur', sendMessage );\n            sendMessage();\n        }\n    });\n\n    this.addAnswer(bubble, {\n        end: function(){\n            bubble.focus();\n        }\n    });\n}\n\nChat.prototype.say = function( path ){\n    var message = this.conversation[ path ];\n    var message = message instanceof Array ? message : [message];\n\n    for( var i = 0; i < message.length; i++ ){\n        setTimeout( function( item ){\n            if( typeof item == 'object' ){\n                if( item.type == 'choose' ){\n                    this.chooseAnswer( item.answers );\n                }else if( item.type == 'text' ){\n                    this.writeAnswer( item );\n                }\n            }else{\n                var bubble = this.createBubble( item );\n                this.addBubble( bubble );\n            }\n        }.bind( this, message[i] ), 1200 * i + 350 );\n    }\n\n}\n"]}